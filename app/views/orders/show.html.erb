
<h3>hello <%=current_user.username %></h3>
<h1>wanna pay <%= @order.amount_cents%> ? </h1>

  <%= form_tag order_path(@order), :method => :put, class: "coffee_form" do %>


    <% if @order.shipping_zone != nil %>
       <p>your delivery zone is :<%= @order.shipping_zone%></p>
    <% else %>
      <%= label_tag Order.human_attribute_name("shipping_zone") %>

      <%= select_tag "shipping_zone", raw("<option>Portugal</option><option>Rest of Europe</option>"), multiple: false, class:"coffee_form btn-block form-control-lg", id:"selected_shipping_zone", onchange: "displayPriceOrder();"  %>
    <% end %>
      <% if @order.shipping_zone == 'Portugal' && @order.shipping_method == nil%>
        <%= label_tag Product.human_attribute_name("shipping_method")%>

        <%= select_tag "shipping_method", raw("<option>regular mail</option><option>registered mail</option>"), multiple: false, class:"coffee_form btn-block form-control-lg", id:"selected_shipping_method"%>
        <div class='mt-3'>
        <%= submit_tag t("addcart"), class: 'btn btn-block btn-warning' %>
      </div>

      <% elsif @order.shipping_zone == 'Rest of Europe'%>
          <p>For any other European country, the shipping method is <%= @order.shipping_method%> only</p>
       <% end %>


  <% end %>

  <%= @order.shipping_cost %>

<% if @order.shipping_method != nil %>
 <button id="pay" class="text-center btn btn-primary mt-3">Pay</button>
      <script src="https://js.stripe.com/v3/">

      </script>
      <script>
        const paymentButton = document.getElementById('pay');
        paymentButton.addEventListener('click', () => {
          const stripe = Stripe('<%= ENV['STRIPE_PUBLISHABLE_KEY'] %>');
          stripe.redirectToCheckout({
            sessionId: '<%= @session.id %>'
          });
        });
      </script>
      <% end %>
